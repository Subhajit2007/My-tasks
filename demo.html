<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Fixer</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #121212; color: white; margin: 0; }
        .container { background: #1e1e1e; padding: 2rem; border-radius: 15px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        button { background: #00c853; color: black; border: none; padding: 15px 30px; font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 20px; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        #status { margin-top: 20px; font-size: 12px; color: #888; border-top: 1px solid #333; pt: 10px; width: 100%; }
        .error { color: #ff5252; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Push Tester</h1>
        <p>Click below for the Congratulations alert.</p>
        <button id="congratsBtn">ðŸŽ‰ CONGRATULATIONS!</button>
        
        <div id="status">
            Checking system compatibility...
        </div>
    </div>

    <script>
        const btn = document.getElementById('congratsBtn');
        const statusDiv = document.getElementById('status');

        // 1. Update status immediately on load
        function updateStatus(msg, isError = false) {
            statusDiv.innerHTML = isError ? `<span class="error">Error: ${msg}</span>` : `Status: ${msg}`;
            console.log(msg);
        }

        if (!("Notification" in window)) {
            updateStatus("This browser doesn't support notifications.", true);
        } else {
            updateStatus(`Permission is currently "${Notification.permission}"`);
        }

        // 2. The Notification Function
        async function fireNotification() {
            // Check if we are on a secure context
            if (window.location.protocol === 'file:') {
                alert("Note: Notifications often fail when opening a file directly. Try using a local server (HTTP/HTTPS).");
            }

            // Request permission
            const permission = await Notification.requestPermission();
            updateStatus(`Permission set to: ${permission}`);

            if (permission === "granted") {
                const options = {
                    body: "YOU DID IT! You successfully triggered a notification! ðŸ†âœ¨",
                    icon: "https://cdn-icons-png.flaticon.com/512/3119/3119338.png",
                    vibrate: [200, 100, 200, 100, 200], // Vibrate phone
                    tag: "congrats-alert", // Overwrites old ones so it doesn't spam
                    renotify: true // Force vibrate/sound even if tag is the same
                };

                try {
                    const n = new Notification("CONGRATULATIONS!", options);
                    
                    n.onclick = () => {
                        window.focus();
                        n.close();
                    };
                } catch (err) {
                    updateStatus("Failed to create notification. (Are you on mobile Safari?)", true);
                }
            } else if (permission === "denied") {
                alert("You blocked notifications! Click the 'Lock' icon in your browser URL bar to Reset Permission.");
            }
        }

        btn.addEventListener('click', fireNotification);
    </script>
</body>
</html>
